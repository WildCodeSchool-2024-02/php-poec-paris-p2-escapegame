{% extends 'layout.html.twig' %} 
{% block stylesheet %}
<link rel="stylesheet" href="/assets/css/room.css" />
{% endblock %}
 {% block content %}
<form method="post" action="challenges/type">
    <img src="/assets/images/{{ room.name }}.png" id="zoom-image" />
    <div id="zoom-zone"></div>
    <div id="open-challenge-zone"></div>
    <p id="description">{{ currentChallenge.description }}</p>
    <button type="submit" id="button" disabled></button>
</form>
{% endblock %} 
{% block javascript %}
<script>
    let imgElement = document.getElementById("zoom-image");
    let zoomZone = document.getElementById("zoom-zone");
    let openChallengeZone = document.getElementById("open-challenge-zone");

    const url = new URL(window.location.href);
    const params = new URLSearchParams(url.search);
    let roomId = params.get("rid");
    let challengeId = params.get("cid");
    
    (function () {
        if (1 === +roomId) {
            zoomZone.classList.add("lobby-zoom");
            var links = document.getElementById("text");
            var first_click = true;
            links.onclick = function() {
                if (first_click) {
                    const changeText = document.querySelector("#text");
                    text.textContent = "Demain matin, l'exposition de Monsieur Daley ouvre ses portes, mais nous  avons un petit souci : le Collier de Perles de Marie Antoinette,  l'objet vedette, a mystérieusement disparu ! Le directeur, le visage  rouge de colère, m'a hurlé de le retrouver avant demain matin, sinon c'est la  porte ! Ah, les joies du métier de conservateur ! Votre mission est  cruciale : aidez-moi à retrouver ce précieux collier et à sauver  l'exposition. Vous aurez besoin de toute votre ingéniosité et de votre  sens de l'observation. Bonne chance, et merci pour votre aide précieuse !";
                    first_click = false;
                } else { 
                    window.location = "http://localhost:8000/room?rid=1&cid=1";
                }
            }
        } else if (2 === +roomId) {
            zoomZone.classList.add("gallery-zoom");
        } else if (3 === +roomId) {
            zoomZone.classList.add("exhibition-zoom");
        }
    })();

    function showText() {
        let textElement = document.getElementById("description");
        if (!textElement.classList.contains("visible")) {
            textElement.classList.add("visible");
        }
    }

    function activateFormButton() {
        let formButton = document.getElementById("button");
        formButton.disabled = false;
        console.log("next page");
    }

    zoomZone.addEventListener("click", function () {
        showText();
        zoomZone.style.visibility = "hidden";
        if (1 === +roomId) {
            var first_click = true;
            zoomZone.onclick = function() {
                if (first_click) {
                    imgElement.classList.add("lobby-zoomed");
                    first_click = false;
                } else { 
                    window.location = `http://localhost:8000/challenges?id=${challengeId}`;
                }
            }
            imgElement.classList.add("lobby-zoomed");
            openChallengeZone.classList.add("lobby-to-challenge");
        } else if (2 === +roomId) {
            imgElement.classList.add("gallery-zoomed");
            openChallengeZone.classList.add("gallery-to-challenge");
        } else if (3 === +roomId) {
            imgElement.classList.add("exhibition-zoomed");
            openChallengeZone.classList.add("exhibition-to-challenge");
        }
    });

    openChallengeZone.addEventListener("click", function () {
        activateFormButton();
    });
</script>
{% endblock %}
